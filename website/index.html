<!DOCTYPE html>
<html>
	<div id="tg-link"></div>
	<button onclick="sign()">Verify address</button>
	
	<script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@1.0.0-beta.36/dist/web3.min.js" integrity="sha256-nWBTbvxhJgjslRyuAKJHK+XcZPlCnmIAAMixz6EefVk=" crossorigin="anonymous"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script async src="https://telegram.org/js/telegram-widget.js?14" data-telegram-login="medousa_bot" data-size="large" data-onauth="onTelegramAuth(user)" data-request-access="write"></script>
	<script>
		let userId
		let username
		let firstName
		let lastName
		let accounts

		function onTelegramAuth(user) {
			userId = user.id
			firstName = user.first_name
			lastName = user.last_name
		}

		function sign() {
			ethereum.enable().then(() => {
				web3.eth.sign(web3.utils.sha3('hello friend'), accounts[0], function (err, res) {
					$.ajax({
						url: `http://localhost:8080/signed`,
						type: 'get',
						data: { 'userId': userId, 'signed': res },
							success: function(result) {
							alert('Now you can close this window')
						}
					})
				})
			})
		}

		window.addEventListener('load', async () => {
			if (window.ethereum) {
				window.web3 = new Web3(ethereum)

				try {
					accounts = await web3.eth.getAccounts()
				} catch (error) {
					console.log(error)
				}
			} else
				alert('Non-Ethereum browser detected. You should consider trying MetaMask!')
		})
	</script>
</html>
